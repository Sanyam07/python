import nltk
from nltk.stem import WordNetLemmatizer


wordnet_lemmatizer = WordNetLemmatizer()
porter_stemmer=nltk.PorterStemmer()

data='At dawn the reapers were already in the rye field. It was the big rectangular field owned by James McDara, the retired engineer. The field started on the slope of a hill and ran down gently to the sea-road that was covered with sand. It was bound by a low stone fence, and the yellow heads of the rye-stalks leaned out over the fence all round in a thick mass, jostling and crushing one another as the morning breeze swept over them with a swishing sound.McDara himself, a white-haired old man in grey tweeds, was standing outside the fence on the sea-road,waving his stick and talking to a few people who had gathered even at that early hour. His brick-red face was all excitement, and he waved his blackthorn stick as he talked in a loud voice to the men about him.I measured it out yesterday," he was saying, "as even as it could be done. Upon my honour there isnt an inch in the difference between one strip and another of the three strips. Dye see? I have laid lines along the length of the field so they cant go wrong. Come here and Ill show ye."He led the men along from end to end of the field and showed how he had measured it off into three even parts and marked the strips with white lines laid along the ground."Now it couldnt be fairer," cried the old man, as excited as a schoolboy. "When I fire my revolver theyll all start together, and the first couple to finish their strip gets a five-pound note." The peasants nodded their heads and looked at old McDara seriously, although each one of them thought he was crazy to spend five pounds on the cutting of a field that could be cut for two pounds. They were, however, almost as excited as McDara himself, for the three best reapers in the whole island of Inverara had entered for the competition. They were now at the top of the field on the slope of the hill ready to commence. Each had his wife with him to tie the sheaves as they were cut and bring food and drink. They had cast lots for the strips by drawing three pieces of seaweed from McDaras hat. Now they had taken up position on their strips awaiting the signal. Although the sun had not yet warmed the earth and the sea breeze was cold, each man had stripped to his shirt. The shirts were open at the chest and the sleeves were rolled above the elbow. They wore grey woollen shirts. Around his waist each had a multi-coloured "crios," a long knitted belt made of pure wool. Below that they wore white frieze drawers with the ends tucked into woollen stockings that were embroidered at the tops. Their feet were protected by raw-hide shoes. None of them wore a cap. The women all wore red petticoats, with a little shawl tied around their heads.On the left were Michael Gill and his wife, Susan. Michael was a long wiry man, with fair hair that came down over his forehead and was cropped to the bone all around the skull. He had a hook nose, and his lean jaws were continually moving backwards and forwards. His little blue eyes were fixed on the ground, and his long white eyelashes almost touched his cheekbones, as if he slept. He stood motionless, with his reaping-hook in his right hand and his left hand in his belt. Now and again he raised his eyelashes, listening for the signal to commence. His wife was almost as tall as himself, but she was plump and rosy-cheeked. A silent woman, she stood there thinking of her eight months old son whom she had left at home in the charge of her mother. In the middle Johnny Bodkin stood with his arms folded and his legs spread wide apart, talking to his wife in a low serious voice. He was a huge man, with fleshy limbs and neck, and black hair that had gone bald over his forehead. His forehead was very white and his cheeks were very red. He always frowned, twitching his black eyebrows. His wife, Mary, was short, thin, sallow-faced, and her upper teeth protruded slightly over her lower lip. On the right were Pat Considine and his wife, Kate. Kate was very big and brawny, with a freckled face and a very marked moustache on her upper lip. She had a great mop of sandy coloured curly hair that kept coming undone. She talked to her husband in a loud, gruff, masculine voice, full of good humour. Her husband, on the other hand, was a small man, small and slim, and beginning to get wrinkles in his face, although he was not yet forty. His face had once been a bricked colour, but now it was becoming sallow. He had lost most of his front teeth. He stood loosely, grinning towards McDara, his little, loose, slim body hiding its strength. Then McDara waved his stick. He lifted his arm. A shot rang out. The reaping race began. In one movement the three men sank to their right knees like soldiers on parade at musketry practice. Their left hands in the same movement closed about a bunch of rye-stalks. The curved reaping-hooks whirled in the air, and then there was a crunching sound, the sound that hungry cows make eating long fresh grass in spring. Then three little slender bunches of rye-stalks lay flat on the dewy grass beneath the fence, one bunch behind each reapers bent left leg. The three women waited in nervous silence for the first sheaf. It would be an omen of victory or defeat. One, two, three, four bunches . . . Johnny Bodkin, snorting like a furious horse, was dropping his bunches almost without stopping. With a loud cheer he raised his reaping-hook in the air and spat on it, crying "First sheaf!" His wife dived at it with both hands. Separating a little bunch of stalks, she encircled the head of the sheaf and then bound it with amazing rapidity, her long thin fingers moving like knitting needles. The other reapers and their wives had not paused to look. All three reapers had cut their first sheaves and their wives were on their knees tying. Working in the same furious manner in which he had begun, Bodkin was soon far ahead of his competitors. He was cutting his sheaves in an untidy manner, and he was leaving hummocks behind him on the ground owing to the irregularities of his strokes, but his speed and strength were amazing. His great hands whirled the hook and closed on the stalks in a ponderous manner, and his body hurtled along like the carcass of an elephant trotting through a forest, but there was a rhythm in the never-ending movement of his limbs that was not without beauty. And behind came his wife, tying, tying speedily, with her hard face gathered together in a serious frown like a person meditating on a grave decision. Considine and his wife were second. Considine, now that he was in action, showed surprising strength and an agility that was goat-like. When his lean, long, bony arms moved to slash the rye, muscles sprang up all over his bent back like an intricate series of springs being pressed. Every time he hopped on his right knee to move along his line of reaping he emitted a sound like a groan cut short. His wife, already perspiring heavily, worked almost on his heels, continually urging him on, laughing and joking in her habitual loud hearty voice. Michael Gill and his wife came last. Gill had begun to reap with the slow methodic movements of a machine driven at low pressure. He continued at exactly the same pace, never changing, never looking up to see where his opponents were. His long lean hands moved noiselessly, and only the sharp crunching rush of the teeth of his reaping-hook through the yellow stalks of the rye could be heard. His long drooping eyelashes were always directed towards the point where his hook was cutting. He never looked behind to see had he enough for a sheaf before beginning another. All his movements were calculated beforehand, calm, monotonous, deadly accurate. Even his breathing was light, and came through his nose like one who sleeps healthily. His wife moved behind him in the same manner, tying each sheaf daintily, without exertion. As the day advanced people gathered from all quarters watching the reapers. The sun rose into the heaven. There was a fierce heat. Not a breath of wind. The rye-stalks no longer moved. They stood in perfect silence, their heads a whitish colour, their stalks golden. Already there was a large irregular gash in the rye, ever increasing. The bare patch, green with little clover plants that had been sown with the rye, was dotted with sheaves, already whitening in the hot sun. Through the hum of conversation the regular crunching of the reaping-hooks could be heard. A little before noon Bodkin had cut half his strip. A stone had been placed on the marking line at half-way, and when Bodkin reached that stone he stood up with the stone in his hand and yelled "This is a proof," he cried, "that there was never a man born in the island of Inverara as good as Johnny Bodkin." There was an answering cheer from the crowd on the fence, but big Kate Considine humorously waved a sheaf above her head and yelled in her rough mans voice : " The day is young yet, Bodkin of the soft flesh!" The crowd roared with laughter, and Bodkin fumed, but he did not reply. His wits were not very sharp. Gill and his wife took no notice. They did not raise their eyes from the reaping. Bodkins wife was the first to go for the midday meal. She brought a can full of cold tea and a whole oven cake of white flour, cut in large pieces, each piece coated heavily with butter. She had four eggs, too, boiled hard. The Bodkin couple had no children, and on that account they could afford to live well, at least far better than the other peasants. Bodkin just dropped his reaping-hook and ravenously devoured three of the eggs, while his wife, no less hungry, ate the fourth. Then Bodkin began to eat the bread-and-butter and drink the cold tea with as much speed as he had reaped the rye. It took him and his wife exactly two minutes and three-quarters to finish that great quantity of food and drink. Out of curiosity, Gallagher, the doctor, counted the time down on the shore-road. As soon as they had finished eating they set to work again as fiercely as ever. Considine had come level with Bodkin, just as Bodkin resumed work, and instead of taking a rest for their meal, Considine and his wife ate in the ancient fashion current among Inverara peasants during contests of the kind. Kate fed her husband as he worked with buttered oaten cake. Now and again she handed him the tea-can and he paused to take a drink. In that way he was still almost level with Bodkin when he had finished eating. The spectators were greatly excited at this eagerness on the part of Considine, and Some began to say that he would win the race. Nobody took any notice of Gill and his wife, but they had never stopped to eat, and they had steadily drawn nearer to their opponents. They were still some distance in the rear, but they seemed quite fresh, whereas Bodkin appeared to be getting exhausted, handicapped by his heavy meal, and Considine was obviously using up the reserves of his strength. Then, when they reached the stone at half-way, Gill quietly laid down his hook and told his wife to bring the meal. She brought it from the fence, buttered oaten bread and a bottle of new milk, with oatmeal in the bottom of the bottle. They ate slowly, and then rested for a while. People began to jeer at them when they saw them resting, but they took no notice. After about twenty minutes they got up to go to work again. A derisive cheer arose, and an old man cried out "Yer a disgrace to me name, Michael"."Never mind, father," called Michael, "the race isnt finished yet" Then he spat on his hands and seized his hook once more. Then, indeed, excitement rose to a high pitch, because the Gill couple resumed work at a great speed. Their movements were as mechanical and regular as before, but they worked at almost twice the speed. People began to shout at them. Then betting began among the gentry. Until now the excitement had not been intense because it seemed a foregone conclusion that Bodkin would win since he was so far ahead. Now, however, Bodkins supremacy was challenged. He still was a long way ahead of Gill, but he was visibly tired, and his hook made mistakes now and again, gripping the earth with its point. Bodkin was lathered with sweat. He now began to look behind him at Gill, irritated by the shouts of the people. Just before four oclock Considine suddenly collapsed, utterly exhausted. He had to be carried over to the fence. A crowd gathered around, and the rector, Mr. Robertson, gave him a swig from his brandy-flask that revived him. He made an effort to go back to work, but he was unable to rise. "Stay there," said his wife angrily, "youre finished. Ill carry on myself." Rolling up her sleeves farther on her fat arms, she went back to the reaping hook, and with a loud yell began to reap furiously. "Bravo," cried McDara, "Ill give the woman a special prize. Gallagher," he cried, hitting the doctor on the shoulder, " after all . . . the Irish race . . . ye know what I mean. . . man, alive." But all centred their attention on the struggle between Bodkin and Gill. Spurred by rage, Bodkin had made a supreme effort, and he began to gain ground once more. His immense body, moving from left to right and back again across his line of reaping, seemed to swallow the long yellow rye-stalks, so quickly did they fall before it. And as the sheaf was completed his lean wife grabbed it up and tied it. But still, when Bodkin paused at five oclock to cast a look behind him, there was Gill coming with terrible regularity. Bodkin suddenly felt all the weariness of the day overcome him. It struck him first in the shape of an intense thirst. He sent his wife up to the fence for their extra can of tea. When she came back with it he began to drink. But the more he drank the thirstier he became. His friends in the crowd of spectators shouted at him in warning, but his thirst maddened him. He kept drinking. The shore-wall and victory were very near now. He kept looking towards it in a dazed way as he whirled his hook. And he kept drinking. Then his senses began to dull. He became sleepy. His movements became almost unconscious. He only saw the wall, and he fought on. He began to talk to himself. He reached the wall at one end of his strip. He had only to cut down to the other end and finish. Three sheaves more, and then Best man in Inverara . . . Five-Pound Note .But just then a ringing cheer came to his ears, and the cry rose on the air: "Gill has won." Bodkin collapsed with a groan'
data=data.split('.')
data=[x.replace('"','').replace(',','').replace('-','').strip() for x in data]
data=[x for x in data if len(x) > 1]

removalTags=['CC','CD','DT','EX','PRP','PRP$','TO','UH','SYM','UH','WP','IN','WRB',':','RB','RBR','RBS']

    
def wordLemma(word):
    return(wordnet_lemmatizer.lemmatize(wordnet_lemmatizer.lemmatize(word,'v'),'n'))
    #return(porter_stemmer.stem(wordnet_lemmatizer.lemmatize(wordnet_lemmatizer.lemmatize(word,'v'),'n')))

def checkPosTag(word):
    numbers=[str(x) for x in range(10)]
    if any([True if x in word else False for x in numbers]):
        return False
    try:
        if(float(word.strip())):
            return False
    except:
        if(len(word.strip())==0):
            return False
        posTag=nltk.pos_tag([word])
        if len(posTag) > 0:
            if posTag[0][1] not in removalTags:
                return True
    return False

newData=[]
for x in data:
    newData.append([wordLemma(y.strip().lower()) for y in x.split(' ') if checkPosTag(y)==True and len(str(y)) > 1])
    
uniqueWords=list(set([y for x in newData for y in x]))
wordLookup={}
for i,x in enumerate(uniqueWords):
    arrTemp=np.zeros(len(uniqueWords))
    arrTemp[i]=1
    wordLookup[x]=arrTemp
    
# Find 3 skipgrams
skipGrams=[]
for i,x in enumerate(newData):
    for y in range(len(x)-3):
        skipGrams.append([newData[i][y],newData[i][y+1]])
        skipGrams.append([newData[i][y],newData[i][y+2]])
        skipGrams.append([newData[i][y],newData[i][y+3]])

trainData=[]
for x in skipGrams:
    trainData.append(np.concatenate((wordLookup['wait'],wordLookup['wait']),axis=0))
    
ae=TFSparseAutoEncoderGraph(np.array(trainData),learningRate=0.01,alpha=0.1,beta=1,klThreshold=0.3)
ae.train(1000)
